From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Simon Gardling <titaniumtown@gmail.com>
Date: Tue, 15 Dec 2020 19:41:16 -0500
Subject: [PATCH] add toggle for sand dupe


diff --git a/src/main/java/me/titaniumtown/misc.java b/src/main/java/me/titaniumtown/misc.java
index 9fd68b4da..b65dae08b 100644
--- a/src/main/java/me/titaniumtown/misc.java
+++ b/src/main/java/me/titaniumtown/misc.java
@@ -112,4 +112,8 @@ public class misc {
         return config.getString(path, config.getString(path));
     }
     
+    public static boolean allowSandDupe = false;
+    private static void experimental() {
+        allowSandDupe = getBoolean("settings.experimental.allow-sand-dupe", allowSandDupe);
+    }
  }
\ No newline at end of file
diff --git a/src/main/java/net/minecraft/server/EntityFallingBlock.java b/src/main/java/net/minecraft/server/EntityFallingBlock.java
index 76aac1b13..a90e76e80 100644
--- a/src/main/java/net/minecraft/server/EntityFallingBlock.java
+++ b/src/main/java/net/minecraft/server/EntityFallingBlock.java
@@ -64,8 +64,8 @@ public class EntityFallingBlock extends Entity {
 
     @Override
     public void tick() {
-        // Paper start - fix sand duping
-        if (this.dead) {
+        // Paper start - fix sand duping // Titanium - add config option for sand duping
+        if (this.dead && !me.titaniumtown.misc.allowSandDupe) {
             return;
         }
         // Paper end - fix sand duping
@@ -91,8 +91,8 @@ public class EntityFallingBlock extends Entity {
 
             this.move(EnumMoveType.SELF, this.getMot());
 
-            // Paper start - fix sand duping
-            if (this.dead) {
+            // Paper start - fix sand duping // Titanium - add config option for sand duping
+            if (this.dead && !me.titaniumtown.misc.allowSandDupe) {
                 return;
             }
             // Paper end - fix sand duping
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
index 784024dac..f33b89b3a 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
@@ -241,7 +241,9 @@ public class PurpurWorldConfig {
     public double voidDamageHeight = -64.0D;
     public int raidCooldownSeconds = 0;
     public int animalBreedingCooldownSeconds = 0;
+    public boolean allowSandDupe = false;
     private void miscGameplayMechanicsSettings() {
+        allowSandDupe = getBoolean("gameplay-mechanics.allow-sand-dupe", allowSandDupe);
         useBetterMending = getBoolean("gameplay-mechanics.use-better-mending", useBetterMending);
         boatEjectPlayersOnLand = getBoolean("gameplay-mechanics.boat.eject-players-on-land", boatEjectPlayersOnLand);
         boatsDoFallDamage = getBoolean("gameplay-mechanics.boat.do-fall-damage", boatsDoFallDamage);
